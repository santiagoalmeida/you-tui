#!/bin/bash
# you-tui - YouTube Terminal Music Player
# Main command with subcommands

COMMAND="${1:-}"

case "$COMMAND" in
    start)
        echo "üöÄ Starting you-tui daemon..."
        systemctl --user start you-tui-daemon
        sleep 1
        if systemctl --user is-active --quiet you-tui-daemon; then
            echo "‚úÖ Daemon started successfully"
            PID=$(pgrep -f you-tui-daemon 2>/dev/null)
            echo "   PID: $PID"
        else
            echo "‚ùå Failed to start daemon"
            systemctl --user status you-tui-daemon
            exit 1
        fi
        ;;
    
    stop)
        if ! systemctl --user is-active --quiet you-tui-daemon; then
            echo "‚ö†Ô∏è  Daemon is not running"
            exit 0
        fi
        echo "‚èπÔ∏è  Stopping you-tui daemon..."
        systemctl --user stop you-tui-daemon
        sleep 1
        if systemctl --user is-active --quiet you-tui-daemon; then
            echo "‚ùå Failed to stop daemon"
            exit 1
        else
            echo "‚úÖ Daemon stopped successfully"
        fi
        ;;
    
    restart)
        echo "üîÑ Restarting you-tui daemon..."
        systemctl --user restart you-tui-daemon
        sleep 1
        if systemctl --user is-active --quiet you-tui-daemon; then
            echo "‚úÖ Daemon restarted successfully"
            PID=$(pgrep -f you-tui-daemon 2>/dev/null)
            echo "   PID: $PID"
        else
            echo "‚ùå Failed to restart daemon"
            systemctl --user status you-tui-daemon
            exit 1
        fi
        ;;
    
    status)
        exec you-tui-status
        ;;
    
    playlist)
        exec you-tui-playlist
        ;;
    
    play)
        if ! systemctl --user is-active --quiet you-tui-daemon; then
            echo "‚ùå Daemon is not running. Start it with: you-tui start"
            exit 1
        fi
        echo '{"command":"Play"}' | socat - UNIX-CONNECT:/tmp/you-tui-daemon.sock > /dev/null 2>&1
        if [ $? -eq 0 ]; then
            echo "‚ñ∂Ô∏è  Playing"
        else
            echo "‚ùå Failed to send play command"
            exit 1
        fi
        ;;
    
    pause)
        if ! systemctl --user is-active --quiet you-tui-daemon; then
            echo "‚ùå Daemon is not running. Start it with: you-tui start"
            exit 1
        fi
        echo '{"command":"Pause"}' | socat - UNIX-CONNECT:/tmp/you-tui-daemon.sock > /dev/null 2>&1
        if [ $? -eq 0 ]; then
            echo "‚è∏Ô∏è  Paused"
        else
            echo "‚ùå Failed to send pause command"
            exit 1
        fi
        ;;
    
    next)
        if ! systemctl --user is-active --quiet you-tui-daemon; then
            echo "‚ùå Daemon is not running. Start it with: you-tui start"
            exit 1
        fi
        echo '{"command":"Next"}' | socat - UNIX-CONNECT:/tmp/you-tui-daemon.sock > /dev/null 2>&1
        if [ $? -eq 0 ]; then
            echo "‚è≠Ô∏è  Next track"
        else
            echo "‚ùå Failed to send next command"
            exit 1
        fi
        ;;
    
    prev|previous|back)
        if ! systemctl --user is-active --quiet you-tui-daemon; then
            echo "‚ùå Daemon is not running. Start it with: you-tui start"
            exit 1
        fi
        echo '{"command":"Previous"}' | socat - UNIX-CONNECT:/tmp/you-tui-daemon.sock > /dev/null 2>&1
        if [ $? -eq 0 ]; then
            echo "‚èÆÔ∏è  Previous track"
        else
            echo "‚ùå Failed to send previous command"
            exit 1
        fi
        ;;
    
    help|--help|-h)
        cat << 'EOF'
you-tui - YouTube Terminal Music Player

Usage:
  you-tui [command]

Commands:
  (none)        Launch interactive client
  
Daemon Control:
  start         Start the daemon
  stop          Stop the daemon
  restart       Restart the daemon
  
Playback Control:
  play          Resume playback
  pause         Pause playback
  next          Skip to next track
  prev          Go to previous track
  
Information:
  status        Show current playback status
  playlist      Show current playlist
  help          Show this help message

Examples:
  you-tui              # Launch interactive client
  you-tui start        # Start daemon
  you-tui status       # Show what's playing
  you-tui next         # Skip to next track
  you-tui playlist     # Show playlist

For more information, visit: https://github.com/santiagoalmeida/you-tui
EOF
        ;;
    
    *)
        # No command or unknown command - launch client
        exec /usr/local/bin/you-tui-client "$@"
        ;;
esac
